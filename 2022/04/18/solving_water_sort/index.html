<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="I have very normal hobbies."><meta name=generator content="Hugo 0.97.3"><title>Solving Water Sort, Part 1 &#183; Kendra Creates</title><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css><!--[if lte IE 8]><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css><![endif]--><!--[if gt IE 8]><!--><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css><!--<![endif]--><!--[if lte IE 8]><link rel=stylesheet href=https://kpendolino.github.io/KendraCreates/css/side-menu-old-ie.css><![endif]--><!--[if gt IE 8]><!--><link rel=stylesheet href=https://kpendolino.github.io/KendraCreates/css/side-menu.css><!--<![endif]--><link rel=stylesheet href=https://kpendolino.github.io/KendraCreates/css/blackburn.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css><link rel=preconnect href=https://fonts.gstatic.com><link href="https://fonts.googleapis.com/css2?family=Raleway&display=swap" rel=stylesheet type=text/css><script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/styles/androidstudio.min.css><script async src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/highlight.min.js></script>
<script>hljs.initHighlightingOnLoad()</script><link rel="shortcut icon" href=https://kpendolino.github.io/KendraCreates/img/favicon.ico type=image/x-icon><link rel=stylesheet href=https://kpendolino.github.io/KendraCreates/css/kendra.css><link rel=stylesheet href=https://kpendolino.github.io/KendraCreates/css/syntax.css></head><body><div id=layout><a href=#menu id=menuLink class=menu-link><span></span></a><div id=menu><a class="pure-menu-heading brand" href=https://kpendolino.github.io/KendraCreates/>Kendra Creates</a><div class=pure-menu><ul class=pure-menu-list><li class=pure-menu-item><a class=pure-menu-link href=https://kpendolino.github.io/KendraCreates/><i class="fa fa-home fa-fw"></i>Home</a></li><li class=pure-menu-item><a class=pure-menu-link href=https://kpendolino.github.io/KendraCreates/post/><i class="fa fa-list fa-fw"></i>Posts</a></li><li class=pure-menu-item><a class=pure-menu-link href=https://kpendolino.github.io/KendraCreates/tags/><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class=pure-menu-item><a class=pure-menu-link href=https://kpendolino.github.io/KendraCreates/about/><i class="fa fa-user fa-fw"></i>&nbsp;About</a></li><li class=pure-menu-item><a class=pure-menu-link href=https://kpendolino.github.io/KendraCreates/cv/><i class="fas fa-award"></i>&nbsp;Curriculum Vitae</a></li><li class=pure-menu-item id=js-toggle><a class=pure-menu-link><i class="fas fa-moon" id=toggle-icon></i>&nbsp; <span id=dark-mode-label>Dark Mode</span></a></li><script>var lightModeIcon="fas fa-sun",darkModeIcon="fas fa-moon",lightModeLabel="Light Mode",darkModeLabel="Dark Mode",body=document.body,switcher=document.getElementById("js-toggle");switcher.addEventListener("click",function(){var e=document.getElementById("toggle-icon"),t=document.getElementById("dark-mode-label");this.classList.toggle("js-toggle--checked"),this.classList.add("js-toggle--focus"),this.classList.contains("js-toggle--checked")?(body.classList.add("dark-mode"),localStorage.setItem("darkMode","true"),t.innerHTML=lightModeLabel,e.className=lightModeIcon):(body.classList.remove("dark-mode"),setTimeout(function(){localStorage.removeItem("darkMode")},100),t.innerHTML=darkModeLabel,e.className=darkModeIcon)}),localStorage.getItem("darkMode")&&(switcher.classList.add("js-toggle--checked"),body.classList.add("dark-mode"),label.innerHTML=lightModeLabel,icon.className=lightModeIcon)</script></ul></div><div class="pure-menu social"><ul class=pure-menu-list><li class=pure-menu-item><a class=pure-menu-link href=https://twitter.com/kpendolino rel=me target=_blank><i class="fab fa-twitter-square fa-fw"></i>Twitter</a></li><li class=pure-menu-item><a class=pure-menu-link href=https://linkedin.com/in/kendra-pendolino-a56543a2 rel=me target=_blank><i class="fab fa-linkedin fa-fw"></i>LinkedIn</a></li><li class=pure-menu-item><a class=pure-menu-link href=https://github.com/kpendolino rel=me target=_blank><i class="fab fa-github-square fa-fw"></i>GitHub</a></li></ul></div><div><div class=small-print><small>&copy; Kendra Pendolino 2022</small></div><div class=small-print><small>Built with&nbsp;<a href=https://gohugo.io/ target=_blank>Hugo</a><br></small><small>Based on &nbsp;<a href=https://github.com/yoshiharuyamashita/blackburn target=_blank>Blackburn</a><br></small><small>Customized by &nbsp;<a href=https://github.com/kpendolino>Kendra</a><br></small><small>Cover art <a href=https://prints.larasantaella.es/>Lara Santaella</a></small></div></div></div><div id=main><section id=cover></section><div class=header><h1>Solving Water Sort, Part 1</h1><h2>I have very normal hobbies.</h2></div><div class=content><div class=post-meta><div>âœ¿&nbsp;&nbsp;
<time>Apr 18, 2022</time></div><div><i class="fa fa-tags fa-fw"></i>
<a class=post-taxonomy-tag href=https://kpendolino.github.io/KendraCreates/tags/python>python</a></div></div><p>You may have seen ads for the Water Sort puzzle game. In case you haven&rsquo;t, it&rsquo;s a pretty standard puzzle game: you&rsquo;ve got <em>n</em>+2 test tubes filled with <em>n</em> different colors. Your job is to pour from one test tube into another until the colors are all sorted out into their own test tubes. The only rule is you can only pour into a tube that is either empty or that has open space over another section of the same color.</p><p>If you know me, you probably know that I consume puzzle games like they&rsquo;re potato chips. I&rsquo;ve gone through over a thousand such puzzles, and I&rsquo;ve noticed that while the standard puzzles are generally quite easy for me, there have been a few that seem to be unsolvable. That is, without voluntarily watching an ad to access an extra empty test tube.</p><p>Is it possible that I just flubbed it, that these puzzles are totally solvable and I just didn&rsquo;t try everything? Of course. But is it possible that this is a calculated business decision on the part of the developers to increase their ad revenue? Also yes.</p><h1 id=the-question>The Question</h1><p>At this point, I had to know: am I not as good at solving these puzzles as I thought, or am I being manipulated (yes, despite paying for the ad-free version) into volunteering to play ads just to be able to progress?</p><h1 id=the-solution-part-1-brute-force-solving>The Solution, Part 1: Brute Force Solving</h1><p>The first part of my solution was to create a Python script that takes the starting state of one of these puzzles and brute-forces a solution. This script methodically tries every possible move, from every possible game state. If it finds a path from the starting state to &ldquo;solved&rdquo;, it prints it out step by step.</p><p>I plugged in the starting state of several normal, solvable puzzles, and they worked fine. Then I plugged in a seemingly unsolvable puzzle and&mldr;it couldn&rsquo;t find a path to solve the puzzle.</p><p>So, there are a few possible explanations at this point. I could have a bug in my script. Or I could have mis-typed the starting state. Or, of course, it could actually be a intentionally un-solvable puzzle.</p><h1 id=the-solution-part-2-parsing-screenshots>The Solution, Part 2: Parsing Screenshots</h1><p>I wasn&rsquo;t sure if I had faithfully copied the puzzle start state into my script - and, unfortunately, I had already moved on in the game - and there&rsquo;s no going back! So moving forward, I decided to grab screenshots of the starting states. Now, I just had to figure out how to parse these in Python to repeatedly get the correct starting point.</p><h2 id=the-approach>The Approach</h2><p>First, I use the Pillow module to read image data. I take the raw image and make a few changes - quantizing the colors to simplify the image, flattening the background to plain black, creating a grayscale copy of the image and running that through an edge detection filter.</p><p>I then take the edge-detection data and read through the image, row by row, splitting the image at rows that are completely black. This gives me a couple of scrap images, plus one image of each row of test tubes. I take those two rows of test tubes and &ldquo;glue&rdquo; the images together to form one horizontal row. I add a few columns of plain black in between just in case.</p><p>Next, I get the edge-detection of the single-row data. This time, I go through the image column by column, splitting at columns that are completely black. This gives me each test tube as its own image. For each test tube, I look at the center column of pixels and create a list of each block of color. This returns something like 1 pixel of light gray for the top edge, a few pixels of black for the headroom at the top of the tube, and then 2-4 chunks of 15-30 pixels each of the colors, followed by another single pixel of light gray for the bottom edge of the tube.</p><p>I could just take the relative arrangement of colors and go from that, but for ease of use, I do store the RGB values of each color. This allows me to print out a &ldquo;fingerprint&rdquo; of each step in the solution <em>with color coding</em> so that it&rsquo;s easy to read.</p><h1 id=putting-it-all-together>Putting It All Together</h1><p>With those two chunks of code married, I plugged in a series of 6 screenshots of easily-solvable puzzles. I was delighted to find that my code parsed the images and solved all 6 in under 10 seconds - even on a fairly underpowered Chromebook. Unfortunately, I don&rsquo;t have a screenshot of the actual puzzle that seemed unsolvable - and naturally, I haven&rsquo;t stumbled on another &ldquo;unsolvable&rdquo; one since starting this project. So for now, I&rsquo;m just excited that my code seems solid.</p><p>Up next, I&rsquo;ll be working through puzzles in the app, actually hoping to find one I can&rsquo;t solve on my own. When I get a little more free time, I&rsquo;ll be packaging my code up in a Jupyter notebook to share with you all.</p><p>In the mean time, I hope you enjoy these beautiful results:</p><table><thead><tr><th style=text-align:center>Before</th><th style=text-align:center>After</th></tr></thead><tbody><tr><td style=text-align:center><img src=https://kpendolino.github.io/KendraCreates/img/lvl990.png style=margin:5px></td><td style=text-align:center><img src=https://kpendolino.github.io/KendraCreates/img/lvl990-solved.png style=margin:5px;width:100%></td></tr></tbody></table><h4><i class="fas fa-share-alt" aria-hidden=true></i>&nbsp;Share!</h4><ul class=share-buttons><li><a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fkpendolino.github.io%2fKendraCreates%2f2022%2f04%2f18%2fsolving_water_sort%2f" target=_blank title="Share on Facebook"><i class="fab fa-facebook" aria-hidden=true></i><span class=sr-only>Share on Facebook</span></a></li>&nbsp;&nbsp;&nbsp;<li><a href="https://twitter.com/intent/tweet?source=https%3a%2f%2fkpendolino.github.io%2fKendraCreates%2f2022%2f04%2f18%2fsolving_water_sort%2f" target=_blank title=Tweet><i class="fab fa-twitter" aria-hidden=true></i><span class=sr-only>Tweet</span></a></li>&nbsp;&nbsp;&nbsp;<li><a href="https://plus.google.com/share?url=https%3a%2f%2fkpendolino.github.io%2fKendraCreates%2f2022%2f04%2f18%2fsolving_water_sort%2f" target=_blank title="Share on Google+"><i class="fab fa-google-plus" aria-hidden=true></i><span class=sr-only>Share on Google+</span></a></li>&nbsp;&nbsp;&nbsp;<li><a href="http://www.tumblr.com/share?v=3&u=https%3a%2f%2fkpendolino.github.io%2fKendraCreates%2f2022%2f04%2f18%2fsolving_water_sort%2f" target=_blank title="Post to Tumblr"><i class="fab fa-tumblr" aria-hidden=true></i><span class=sr-only>Post to Tumblr</span></a></li>&nbsp;&nbsp;&nbsp;<li><a href="http://pinterest.com/pin/create/button/?url=https%3a%2f%2fkpendolino.github.io%2fKendraCreates%2f2022%2f04%2f18%2fsolving_water_sort%2f" target=_blank title="Pin it"><i class="fab fa-pinterest-p" aria-hidden=true></i><span class=sr-only>Pin it</span></a></li>&nbsp;&nbsp;&nbsp;<li><a href="http://www.reddit.com/submit?url=https%3a%2f%2fkpendolino.github.io%2fKendraCreates%2f2022%2f04%2f18%2fsolving_water_sort%2f" target=_blank title="Submit to Reddit"><i class="fab fa-reddit-alien" aria-hidden=true></i><span class=sr-only>Submit to Reddit</span></a></li></ul><style>ul.share-buttons{list-style:none;padding:0}ul.share-buttons li{display:inline}ul.share-buttons .sr-only{position:absolute;clip:rect(1px 1px 1px 1px);clip:rect(1px,1px,1px,1px);padding:0;border:0;height:1px;width:1px;overflow:hidden}</style><div class="prev-next-post pure-g"><div class=pure-u-1-24 style=text-align:left><a href=https://kpendolino.github.io/KendraCreates/2022/04/02/creating_data_sets/><i class="fa fa-chevron-left"></i></a></div><div class=pure-u-10-24><nav class=prev><a href=https://kpendolino.github.io/KendraCreates/2022/04/02/creating_data_sets/>Creating Data Sets</a></nav></div><div class=pure-u-2-24>&nbsp;</div><div class=pure-u-10-24></div><div class=pure-u-1-24 style=text-align:right></div></div></div></div></div><script src=https://kpendolino.github.io/KendraCreates/js/ui.js></script>
<script src=https://kpendolino.github.io/KendraCreates/js/menus.js></script></body></html>